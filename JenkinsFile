pipeline {
    agent any
        options {
        timeout(time: 60, unit: 'SECONDS')
        }
    triggers {
        cron('0 8 * * *')   // Runs once a day
        // If you prefer a fixed time, use: cron('0 0 * * *')
    }
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/jamwil907/JayErvin_M4Assgn1.git' // gitlab repository that utilizes php
                }
    }

        stage('Dependency Management') {
            steps {
                sh '''
                    echo "Running PHP dependency checks (no composer.json found)..."

                    echo "1) Checking PHP syntax for all .php files..."
                    find . -name "*.php" -print0 | xargs -0 -n1 php -l

                    echo "2) Checking include/require dependencies..."
                    MISSING=0
                    for FILE in $(grep -RhoP "(?<=include|require|include_once|require_once)\\s*['\\\"]([^'\\\"]+)['\\\"]" . | sed "s/['\\\"]//g"); do
                        if [ ! -f "$FILE" ]; then
                            echo "Missing dependency: $FILE"
                            MISSING=1
                        fi
                    done

                    if [ $MISSING -eq 1 ]; then
                        echo "ERROR: One or more PHP dependency files are missing."
                        exit 1
                    else
                        echo "All PHP dependency paths are valid."
                    fi

                    echo "3) Checking for .bat scripts..."
                    if ls *.bat >/dev/null 2>&1; then
                        echo "Found .bat files:"
                        ls *.bat
                    else
                        echo "No .bat scripts found. Continuing..."
                    fi
                '''
            }
        }
        stage('Deliver') {
            steps {
                echo 'Deliver....'
                sh '''
                echo "package delivery.."
                '''
            }
        }
    }
}
