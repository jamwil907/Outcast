pipeline {
    agent any
        options {
        timeout(time: 60, unit: 'SECONDS')
        }
    triggers {
        cron('0 8 * * *')   // Runs once a day
        // If you prefer a fixed time, use: cron('0 0 * * *')
    }
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/jamwil907/JayErvin_M4Assgn1.git' // gitlab repository that utilizes php
                }
    }

        stage('Shell Script Dependency Check') {
            steps {
                sh '''
                    echo "Checking .sh file dependencies..."

                    # Check if the shell script exists
                    if [ -f build-container.sh ]; then
                        echo "Found build-container.sh"

                        # Ensure it is executable
                        if [ ! -x build-container.sh ]; then
                            echo "Making build-container.sh executable"
                            chmod +x build-container.sh
                        fi

                        # Optional: check for syntax errors
                        bash -n build-container.sh || { echo "Syntax error in build-container.sh"; exit 1; }

                        echo "Shell script dependency check passed."
                    else
                        echo "ERROR: build-container.sh not found!"
                        exit 1
                    fi
                '''
            }
        }

        stage('Test') {
            steps {
                sh '''
                    echo "Running PHP test scripts..."

                    # List of test scripts
                    TEST_FILES="test_weather.php other_test.php"  # Add all your test files here

                    for TEST in $TEST_FILES; do
                        if [ -f "$TEST" ]; then
                            echo "Running $TEST..."
                            php "$TEST" || { echo "Test $TEST failed!"; exit 1; }
                        else
                            echo "WARNING: Test file $TEST not found, skipping."
                        fi
                    done

                    echo "All tests completed successfully."
                '''
            }
        }

        stage('Deliver') {
            steps {
                echo 'Deliver....'
                sh '''
                echo "package delivery.."
                '''
            }
        }
    }
    post {
        success {
            echo "Pipeline completed successfully!"
        }
        failure {
            echo "Pipeline failed. Check the logs for errors."
        }
        always {
            echo "This will always run, regardless of success or failure."
        }
    }
}
